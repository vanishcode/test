"use strict";(self.webpackChunkdemo=self.webpackChunkdemo||[]).push([[1727],{81727:(e,t,n)=>{n.r(t),n.d(t,{ParticleDelegateProvider:()=>J,ParticleProvider:()=>Z});var i,r,s,o,a,h,c,u,d,l,p,m,f,g,v,y=n(75432),P=n(88767),w=n(66650),b=n(48834),_=n(22699),j=n(89644),x=Object.defineProperty,C=Object.defineProperties,T=Object.getOwnPropertyDescriptor,I=Object.getOwnPropertyDescriptors,q=Object.getOwnPropertyNames,E=Object.getOwnPropertySymbols,S=Object.prototype.hasOwnProperty,D=Object.prototype.propertyIsEnumerable,O=(e,t,n)=>t in e?x(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,k=(e,t,n)=>new Promise(((i,r)=>{var s=e=>{try{a(n.next(e))}catch(e){r(e)}},o=e=>{try{a(n.throw(e))}catch(e){r(e)}},a=e=>e.done?i(e.value):Promise.resolve(e.value).then(s,o);a((n=n.apply(e,t)).next())})),H={};((e,t)=>{for(var n in t)x(e,n,{get:t[n],enumerable:!0})})(H,{default:()=>v,dependencies:()=>p,devDependencies:()=>m,files:()=>s,gitHead:()=>g,license:()=>u,main:()=>a,module:()=>h,name:()=>i,peerDependencies:()=>l,publishConfig:()=>d,scripts:()=>f,type:()=>o,types:()=>c,version:()=>r});var A,N,L=(A={"package.json"(){v={name:i="@particle-network/provider",version:r="1.3.2",files:s=["es","lib","LICENSE"],type:o="module",main:a="lib/index.js",module:h="es/index.js",types:c="lib/types/index.d.ts",license:u="Apache-2.0",publishConfig:d={access:"public"},peerDependencies:l={"@particle-network/auth":"*"},dependencies:p={"@particle-network/chains":"*",axios:"^1.3.6",uuid:"^8.3.2"},devDependencies:m={"@particle-network/auth":"^1.3.1","@types/uuid":"^8.3.4","ts-loader":"^9.3.1","webpack-cli":"^4.10.0"},scripts:f={package:'shx echo \'{ "type": "commonjs" }\' > lib/package.json',build:"yarn clean && node ./esBuild.js && tsc --emitDeclarationOnly -p tsconfig.json && yarn package",clean:"shx rm -rf lib/* && shx rm -rf es/*","build:min.js":"webpack",version:"yarn build"},gitHead:g="cc999e430ebfb1dd821783f7cf099ddd51f3495a"}}},function(){return A&&(N=(0,A[q(A)[0]])(A=0)),N}),M=class extends Error{constructor(e,t,n){super(t),this.code=e,this.message=t,this.data=n,this.code=e,this.message=t,this.data=n}static userRejectedRequest(){return new M(4001,"The user rejected the request")}static userCancelOperation(){return new M(4011,"The user cancel the operation")}static unauthorized(){return new M(4100,"The requested method and/or account has not been authorized by the user")}static unsupportedMethod(){return new M(4200,"The Provider does not support the requested method")}static unsupportedChain(){return new M(4201,"The Provider does not support the chain")}static disconnected(){return new M(4900,"The Provider is disconnected from all chains")}static chainDisconnected(){return new M(4901,"The Provider is not connected to the requested chain")}static paramsError(){return new M(8002,"Param error, see doc for more info")}},U=class{},B=class extends U{constructor(){super(...arguments),this.events=new _.EventEmitter}on(e,t){return this.events.on(e,t),this}once(e,t){return this.events.once(e,t),this}off(e,t){return this.events.off(e,t),this}removeListener(e,t){return this.events.removeListener(e,t),this}},R=class extends U{constructor(){super(...arguments),this.events=new _.EventEmitter}on(e,t){return this.events.on(e,t),this}once(e,t){return this.events.once(e,t),this}off(e,t){return this.events.off(e,t),this}removeListener(e,t){return this.events.removeListener(e,t),this}},W=["eth_signTransaction","eth_sign","eth_sendRawTransaction"],$=["eth_requestAccounts","eth_accounts","eth_chainId","eth_sendTransaction","eth_signTypedData","eth_signTypedData_v1","eth_signTypedData_v3","eth_signTypedData_v4","personal_sign","wallet_switchEthereumChain","wallet_addEthereumChain","wallet_watchAsset"],z=["personal_sign_uniq","eth_signTypedData_v4_uniq"],K=class extends B{constructor(e){if(super(),this.config=e,this.registering=!1,!(0,y.isHttpUrl)(e.url))throw new Error(`Provided URL is not compatible with HTTP connection: ${e.url}`);this.config=e}get connected(){return void 0!==this.api}get connecting(){return this.registering}open(){return k(this,null,(function*(){this.api=yield this.register()}))}close(){return k(this,null,(function*(){this.onClose()}))}send(e){return k(this,null,(function*(){return void 0===this.api&&(this.api=yield this.register()),this.api.post("/",e).then((e=>e.data))}))}register(){return k(this,null,(function*(){const e=this.config;if(!(0,y.isHttpUrl)(e.url))throw new Error(`Provided URL is not compatible with HTTP connection: ${e.url}`);if(this.registering)return new Promise(((e,t)=>{this.events.once("open",(()=>{if(void 0===this.api)return t(new Error("HTTP connection is missing or invalid"));e(this.api)}))}));this.registering=!0;const t=j.create({baseURL:e.url,timeout:3e4,headers:{Accept:"application/json","Content-Type":"application/json"}});return t.interceptors.request.use((function(t){var n,i;return t.params||(t.params={}),t.params.chainId=null!=(i=null==(n=t.data)?void 0:n.chainId)?i:e.chainId(),t.params.projectUuid=e.authentication.projectId,t.params.projectKey=e.authentication.clientKey,t}),(e=>Promise.reject(e))),this.onOpen(t),t}))}onOpen(e){this.api=e,this.registering=!1,this.events.emit("open")}onClose(){this.api=void 0,this.events.emit("close")}},Z=class extends R{constructor(e){super(),this.auth=e,this.isParticleNetwork=!0,this.auth=e,this.connection=this.setConnection(),this.authAdapter=new class{constructor(e){this.auth=e,this.auth=e}request(e){return k(this,null,(function*(){if("eth_requestAccounts"===e.method||"eth_accounts"===e.method){let e=this.auth.getWallet();if(e)return[e.public_address];if(yield this.auth.login(),e=this.auth.getWallet(),e)return[e.public_address];throw new Error("Create wallet failed")}if("eth_chainId"===e.method)return(0,y.intToHex)(this.auth.getChainId());if("eth_sendTransaction"===e.method){if(e.params&&e.params instanceof Array&&e.params[0]){const t=e.params[0];return(0,y.isNullish)(t.type)&&(w.p5.isChainSupportEIP1559(this.auth.getChain())?t.type="0x2":t.type="0x0"),(0,y.isNullish)(t.chainId)&&(t.chainId=(0,y.intToHex)(this.auth.getChainId())),(0,y.isNullish)(t.nonce)&&(t.nonce="0x0"),(0,y.isNullish)(t.data)&&(t.data="0x"),this.auth.sendTransaction(this.legacyToString(e.params[0]))}return Promise.reject(M.paramsError())}if("eth_signTypedData_v3"===e.method||"eth_signTypedData_v4"===e.method||"eth_signTypedData_v4_uniq"===e.method){if(e.params&&e.params instanceof Array&&e.params.length>=2){let t=e.params[1];return"string"!=typeof t||t.startsWith("0x")||(t=(0,y.addHexPrefix)(b.Buffer.from(t).toString("hex"))),this.auth.sign(e.method,this.legacyToString(t))}return Promise.reject(M.paramsError())}if("eth_signTypedData"===e.method||"eth_signTypedData_v1"===e.method){if(e.params&&e.params instanceof Array&&e.params[0]){let t=e.params[0];return"string"!=typeof t||t.startsWith("0x")||(t=(0,y.addHexPrefix)(b.Buffer.from(t).toString("hex"))),this.auth.sign(e.method,this.legacyToString(t))}return Promise.reject(M.paramsError())}if("personal_sign"===e.method||"personal_sign_uniq"===e.method)return e.params&&e.params instanceof Array&&e.params[0]?this.auth.sign(e.method,this.legacyToString(e.params[0])):Promise.reject(M.paramsError());if("wallet_switchEthereumChain"===e.method){if(e.params&&e.params instanceof Array&&e.params[0]&&e.params[0].chainId){const t=Number(e.params[0].chainId),n=w.p5.getEVMChainInfoById(t);return n?(yield this.auth.switchChain(n),Promise.resolve(null)):Promise.reject(M.unsupportedChain())}return Promise.reject(M.paramsError())}return Promise.reject(M.unsupportedMethod())}))}legacyToString(e){let t;return t="number"==typeof e?(0,y.addHexPrefix)(e.toString(16)):"string"==typeof e?e.toString().startsWith("0x")?e:(0,y.addHexPrefix)(b.Buffer.from(e).toString("hex")):(0,y.addHexPrefix)(b.Buffer.from(JSON.stringify(e)).toString("hex")),t}}(this.auth),this.auth.on("chainChanged",(e=>{"Solana"!==e.name&&this.emit("chainChanged",(0,y.intToHex)(e.id))})),"undefined"!=typeof window&&window.particle&&(window.particle.particleProvider=this)}get version(){return`web_${(L(),e=H,((e,t,n,i)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let n of q(t))S.call(e,n)||void 0===n||x(e,n,{get:()=>t[n],enumerable:!(i=T(t,n))||i.enumerable});return e})(x({},"__esModule",{value:!0}),e)).version}`;var e}setConnection(){return new K({url:`${(0,y.rpcUrl)()}/evm-chain`,basicCredentials:this.auth.basicCredentials(),chainId:()=>this.auth.getChainId(),authentication:this.auth.config})}emit(e,...t){return this.events.emit(e,...t)}disconnect(){return k(this,null,(function*(){return this.auth.logout()}))}enable(){return k(this,null,(function*(){return this.request({method:"eth_requestAccounts"})}))}request(e){return k(this,null,(function*(){var t,n;if(!e.method||W.includes(e.method))return Promise.reject(M.unsupportedMethod());this.connection.connected||(yield this.open());const i={chainId:Number(this.auth.getChainId()),id:null!=(t=e.id)?t:(0,P.Z)(),jsonrpc:null!=(n=e.jsonrpc)?n:"2.0",method:e.method,params:e.params};return $.includes(e.method)||z.includes(e.method)?this.authAdapter.request(e):this.requestStrict(i)}))}requestStrict(e){return k(this,null,(function*(){return this.connection.send(e).then((e=>e.error?Promise.reject(e.error):Promise.resolve(e.result)))}))}open(){return k(this,null,(function*(){yield this.connection.open(),this.connection.on("close",(()=>this.emit("disconnect"))),this.emit("connect",{chainId:(0,y.intToHex)(this.auth.getChainId())})}))}close(){return k(this,null,(function*(){yield this.connection.close()}))}},J=class extends R{constructor(e,t){super(),this.auth=e,this.signerProvider=t,this.isParticleDelegateProvider=!0,this.connection=this.setConnection(),this.listenEvent()}listenEvent(){const e=this.events;this.signerProvider.on("connect",(t=>e.emit("connect",t))),this.signerProvider.on("disconnect",(t=>e.emit("disconnect",t))),this.signerProvider.on("message",(t=>e.emit("message",t))),this.signerProvider.on("chainChanged",(t=>e.emit("chainChanged",t))),this.signerProvider.on("accountsChanged",(t=>e.emit("accountsChanged",t)))}setConnection(){return new K({url:`${(0,y.rpcUrl)()}/evm-chain`,basicCredentials:this.auth.basicCredentials(),chainId:()=>{var e;return null!=(e=this.chainId)?e:this.auth.getChainId()},authentication:this.auth.config})}disconnect(){return k(this,null,(function*(){const e=this.signerProvider;if(e.disconnect&&"function"==typeof e.disconnect)try{yield e.disconnect()}catch(e){}}))}enable(){return k(this,null,(function*(){const e=this.signerProvider;let t;if(e.enable&&"function"==typeof e.enable)try{t=yield e.enable()}catch(e){t=yield this.request({method:"eth_requestAccounts"})}return t}))}request(e){return k(this,null,(function*(){var t,n;if(!e.method||W.includes(e.method))return Promise.reject(M.unsupportedMethod());this.connection.connected||(yield this.open());const i={id:null!=(t=e.id)?t:(0,P.Z)(),jsonrpc:null!=(n=e.jsonrpc)?n:"2.0",method:e.method,params:e.params};if($.includes(i.method)||this.isParticleSignerMethod(i.method))return yield this.signerProvider.request(i);{try{this.chainId=Number(yield this.signerProvider.request({method:"eth_chainId"}))}catch(e){this.chainId=Number(this.auth.getChainId())}const e=(r=((e,t)=>{for(var n in t||(t={}))S.call(t,n)&&O(e,n,t[n]);if(E)for(var n of E(t))D.call(t,n)&&O(e,n,t[n]);return e})({},i),s={chainId:this.chainId},C(r,I(s)));return yield this.requestStrict(e)}var r,s}))}isParticleSignerMethod(e){return this.signerProvider.isParticleNetwork&&z.includes(e)}requestStrict(e){return k(this,null,(function*(){return this.connection.send(e).then((e=>e.error?Promise.reject(e.error):Promise.resolve(e.result)))}))}open(){return k(this,null,(function*(){yield this.connection.open()}))}}}}]);